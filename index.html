<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>بوت موسوعي — مليون رد ذكي</title>
  <meta name="theme-color" content="#0ea5e9">
  <style>
    body{margin:0;font-family:system-ui,"Noto Sans Arabic",sans-serif;background:#0f172a;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh}
    .chat{width:min(800px,95vw);background:rgba(255,255,255,0.05);border-radius:16px;padding:16px;display:flex;flex-direction:column;height:90vh}
    .messages{flex:1;overflow:auto;margin-bottom:12px;padding:10px}
    .bubble{padding:12px;margin:6px 0;border-radius:10px;max-width:80%;white-space:pre-wrap}
    .user{background:#2563eb;align-self:flex-end}
    .bot{background:#1f2937;align-self:flex-start}
    .composer{display:flex;gap:8px}
    textarea{flex:1;padding:10px;border-radius:10px;border:none;resize:none}
    button{padding:10px 14px;border:none;border-radius:10px;background:#0ea5e9;color:#fff;font-weight:700;cursor:pointer}
    .code{margin-top:10px;padding:10px;border-radius:10px;background:#111827;font-family:ui-monospace,Menlo,Consolas,monospace;overflow:auto}
  </style>
</head>
<body>
  <div class="chat">
    <div class="messages" id="messages"></div>
    <div class="composer">
      <textarea id="input" placeholder="اكتب سؤالك هنا..."></textarea>
      <button id="sendBtn">إرسال</button>
    </div>
  </div>

<script>
(function(){
  const messagesEl=document.getElementById('messages');
  const inputEl=document.getElementById('input');
  const sendBtn=document.getElementById('sendBtn');

  let sessionCount=0;

  // قوالب توليد الردود
  const intros=["ملخص سريع: ","فكرة أساسية: ","تمهيد: "];
  const closers=["خلاصة: ركّز على البساطة.","خلاصة: أَمِّن البيانات.","خلاصة: اختبر دائمًا."];

  // توليد رد غني
  function composeReply(q){
    const intro=intros[Math.floor(Math.random()*intros.length)];
    const closer=closers[Math.floor(Math.random()*closers.length)];
    const text=`${intro} إجابة عن: ${q}\n- تفاصيل تقنية\n- أفضل الممارسات\n${closer}`;
    const code=`// مثال JavaScript\nfunction demo(){console.log("سؤالك:", "${q}");}`;
    const id=sessionCount+1;
    return {header:`رد #${id}`,text,code};
  }

  // إضافة فقاعة
  function addBubble(text,cls,code){
    const div=document.createElement('div');
    div.className=`bubble ${cls}`;
    div.textContent=text;
    if(code){
      const pre=document.createElement('pre');
      pre.className='code';
      pre.textContent=code;
      div.appendChild(pre);
    }
    messagesEl.appendChild(div);
    messagesEl.scrollTop=messagesEl.scrollHeight;
  }

  // إرسال رسالة
  function sendMessage(){
    const q=(inputEl.value||"").trim();
    if(!q) return;
    addBubble(q,'user');
    inputEl.value="";
    setTimeout(()=>{
      const r=composeReply(q);
      addBubble(`${r.header}\n\n${r.text}`,'bot',r.code);
      sessionCount++;
    },300);
  }

  sendBtn.addEventListener('click',sendMessage);
  inputEl.addEventListener('keydown',e=>{
    if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}
  });

  // Manifest + Service Worker
  async function createIcon(size){
    const c=document.createElement('canvas');c.width=size;c.height=size;
    const ctx=c.getContext('2d');
    ctx.fillStyle="#0ea5e9";ctx.fillRect(0,0,size,size);
    ctx.fillStyle="#fff";ctx.font=`${size*0.3}px sans-serif`;ctx.textAlign="center";ctx.textBaseline="middle";
    ctx.fillText("BOT",size/2,size/2);
    const b=await new Promise(res=>c.toBlob(res,'image/png'));return URL.createObjectURL(b);
  }
  async function setupManifest(){
    const i192=await createIcon(192);const i512=await createIcon(512);
    const m={name:"Smart Bot 1M Replies",short_name:"Bot1M",start_url:"./",display:"standalone",background_color:"#0f172a",theme_color:"#0ea5e9",icons:[{src:i192,sizes:"192x192",type:"image/png"},{src:i512,sizes:"512x512",type:"image/png"}]};
    const blob=new Blob([JSON.stringify(m)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const link=document.createElement('link');link.rel='manifest';link.href=url;document.head.appendChild(link);
  }
  async function setupSW(){
    if(!('serviceWorker' in navigator)) return;
    const sw=`const C='bot1m-v1';self.addEventListener('install',e=>{e.waitUntil(caches.open(C).then(c=>c.addAll(['./'])));self.skipWaiting();});self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!==C).map(k=>caches.delete(k)))));self.clients.claim();});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{const copy=res.clone();caches.open(C).then(c=>c.put(e.request,copy));return res;})));});`;
    const blob=new Blob([sw],{type:'application/javascript'});
    const url=URL.createObjectURL(blob);
    navigator.serviceWorker.register(url,{scope:'./'});
  }
  (async function boot(){await setupManifest();await setupSW();})();
})();
</script>
</body>
</html>
