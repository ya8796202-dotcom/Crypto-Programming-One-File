<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>YASSER BOT â€” Ù…Ù„ÙŠÙˆÙ† Ø±Ø¯ Ø°ÙƒÙŠ</title>
  <meta name="theme-color" content="#0ea5e9">
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8;
      --primary:#0ea5e9; --accent:#22d3ee; --user:#2563eb; --bot:#1f2937;
      --glass:rgba(255,255,255,0.06); --glassBorder:rgba(255,255,255,0.12);
    }
    /* ÙˆØ¶Ø¹ Ø£ØµÙØ± Ø²Ø¬Ø§Ø¬ÙŠ Ø£Ù†ÙŠÙ‚ */
    :root.theme-yellow{
      --bg:#0a0a06; --panel:#14140a; --text:#fffbe6; --muted:#f7e8a1;
      --primary:#f5c518; --accent:#ffd65b; --user:#f5c518; --bot:#2a240f;
      --glass:rgba(245,197,24,0.10); --glassBorder:rgba(245,197,24,0.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,"Noto Sans Arabic",Segoe UI,Roboto,sans-serif;
      background:linear-gradient(160deg,var(--bg),var(--panel)); color:var(--text);
      display:flex; align-items:center; justify-content:center;
    }
    .app{
      width:min(1200px,96vw); height:min(92vh,920px);
      display:grid; grid-template-columns:360px 1fr; gap:14px;
      padding:18px; border-radius:18px;
      background:linear-gradient(180deg, var(--glass), rgba(255,255,255,0.03));
      border:1px solid var(--glassBorder);
      backdrop-filter:blur(12px) saturate(1.1);
      box-shadow:0 25px 60px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .sidebar, .main{
      background:var(--glass); border:1px solid var(--glassBorder);
      border-radius:16px;
    }
    .sidebar{padding:14px; display:flex; flex-direction:column; gap:12px; overflow:auto}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:44px; height:44px; border-radius:12px;
      background:conic-gradient(from 210deg,var(--primary),var(--accent),#6366f1,var(--primary));
      box-shadow:0 6px 20px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.35);
    }
    .title{font-weight:800; letter-spacing:.2px}
    .muted{color:var(--muted); font-size:.92rem}
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    .btn{
      appearance:none; border:1px solid var(--glassBorder); outline:none; cursor:pointer;
      padding:10px 12px; border-radius:10px; font-weight:700; color:white;
      background:linear-gradient(180deg,var(--primary),#2563eb);
      transition:transform .12s ease, filter .2s ease;
    }
    .btn:hover{transform:translateY(-1px); filter:saturate(1.06)}
    .btn.secondary{background:linear-gradient(180deg,#1f2937,var(--panel))}
    .select,.input{
      width:100%; background:rgba(2,6,23,0.45); color:var(--text);
      border:1px solid var(--glassBorder); border-radius:10px; padding:10px;
      backdrop-filter:blur(6px);
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
      background:rgba(34,197,94,0.12); color:#a7f3d0; border:1px dashed rgba(34,197,94,0.35); font-weight:700;
    }
    .badge.warn{background:rgba(245,158,11,0.12); color:#fde68a; border-color:rgba(245,158,11,0.35)}
    .modeRow{display:flex; gap:8px; flex-wrap:wrap}
    .main{display:flex; flex-direction:column}
    .messages{flex:1; overflow:auto; padding:16px}
    .bubble{
      max-width:72%; margin:6px 0; padding:12px; border-radius:12px; white-space:pre-wrap;
      background:rgba(255,255,255,0.08); border:1px solid var(--glassBorder);
      box-shadow:0 8px 24px rgba(0,0,0,0.25);
    }
    .bubble.user{background:linear-gradient(180deg,var(--user),#1e40af); margin-left:auto}
    .bubble.bot{background:linear-gradient(180deg,var(--bot),#111827); margin-right:auto}
    .composer{
      display:flex; gap:10px; padding:12px; border-top:1px solid var(--glassBorder);
      background:linear-gradient(180deg, rgba(0,0,0,0.15), rgba(0,0,0,0.25)); backdrop-filter:blur(6px);
    }
    textarea{
      flex:1; resize:none; min-height:48px; max-height:180px; padding:10px;
      border-radius:10px; border:1px solid var(--glassBorder);
      background:rgba(2,6,23,0.45); color:var(--text);
    }
    .code{
      margin-top:10px; padding:10px; border-radius:10px;
      background:rgba(2,6,23,0.6); border:1px solid var(--glassBorder);
      font-family:ui-monospace,Menlo,Consolas,monospace; overflow:auto;
    }
    .small{font-size:.92rem}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(96,165,250,0.12);color:#bfdbfe;border:1px dashed rgba(96,165,250,0.35);font-weight:700}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">YASSER BOT â€” Ù…Ù„ÙŠÙˆÙ† Ø±Ø¯ Ø°ÙƒÙŠ</div>
          <div class="muted">ÙˆØ§Ø¬Ù‡Ø© Ø²Ø¬Ø§Ø¬ÙŠØ© Ø£Ù†ÙŠÙ‚Ø© + PWA + Ø±Ø¯ÙˆØ¯ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª</div>
        </div>
      </div>

      <div class="controls">
        <button id="installBtn" class="btn">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
        <button id="downloadBtn" class="btn secondary">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</button>
      </div>

      <label class="small">Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
      <select id="domainSelect" class="select">
        <option value="">ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
        <option>Ø¨Ø±Ù…Ø¬Ø©</option>
        <option>ØªØ´ÙÙŠØ±</option>
        <option>Ø´Ø¨ÙƒØ§Øª</option>
        <option>Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</option>
        <option>Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
        <option>Ù‡Ù†Ø¯Ø³Ø© Ø¨Ø±Ù…Ø¬ÙŠØ§Øª</option>
        <option>Ø£Ù…Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
        <option>Ø³Ø­Ø§Ø¨Ø©</option>
        <option>Ø£Ù†Ø¸Ù…Ø©</option>
        <option>ÙˆØ§Ø¬Ù‡Ø§Øª ÙˆØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</option>
        <option>Ù‡Ø²Ø§Ø±</option>
        <option>Ø§Ø®ØªØ±Ø§Ù‚</option>
      </select>

      <label class="small">Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¯</label>
      <select id="styleSelect" class="select">
        <option value="Ù…Ø®ØªØµØ±">Ù…Ø®ØªØµØ±</option>
        <option value="Ù…ÙØµÙ„">Ù…ÙØµÙ„</option>
        <option value="ØªÙ‚Ù†ÙŠ">ØªÙ‚Ù†ÙŠ</option>
        <option value="ØªØ¹Ù„ÙŠÙ…ÙŠ">ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
        <option value="Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø§Ø·">Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø§Ø·</option>
      </select>

      <label class="small">Ø¥Ø¶Ø§ÙØ© Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø±Ù…Ø¬ÙŠØ©</label>
      <select id="codeSelect" class="select">
        <option value="Ù„Ø§">Ù„Ø§</option>
        <option value="JavaScript">JavaScript</option>
        <option value="Python">Python</option>
        <option value="C#">C#</option>
        <option value="SQL">SQL</option>
        <option value="Shell">Shell</option>
      </select>

      <div class="modeRow">
        <span class="pill">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹</span>
        <button id="modeDarkBtn" class="btn">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
        <button id="modeYellowBtn" class="btn secondary">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ØµÙØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ</button>
      </div>

      <div class="badge" id="capBadge">ÙØ¶Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯: ~1,000,000 Ø±Ø¯ Ù…Ù…ÙƒÙ†</div>
      <div class="badge warn" id="countBadge">Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: 0 Ø±Ø¯</div>

      <div class="muted small">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù€ "Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚" Ø³ØªÙƒÙˆÙ† Ø¹Ø§Ù…Ø© ÙˆØªÙˆØ¹ÙˆÙŠØ© ÙˆØºÙŠØ± ØªØ¹Ù„ÙŠÙ…Ø§Øª ÙØ¹Ù„ÙŠØ©. Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©.
      </div>
    </aside>

    <main class="main">
      <div id="messages" class="messages"></div>
      <div class="composer">
        <textarea id="input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..."></textarea>
        <button id="sendBtn" class="btn">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </main>
  </div>

<script>
(function(){
  const messagesEl = document.getElementById('messages');
  const inputEl = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');
  const countBadge = document.getElementById('countBadge');
  const domainSelect = document.getElementById('domainSelect');
  const styleSelect = document.getElementById('styleSelect');
  const codeSelect = document.getElementById('codeSelect');
  const installBtn = document.getElementById('installBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const modeDarkBtn = document.getElementById('modeDarkBtn');
  const modeYellowBtn = document.getElementById('modeYellowBtn');

  let sessionCount = 0;
  let deferredPrompt = null;

  // Ù…Ø¬Ø§Ù„Ø§Øª ÙˆÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©
  const DOMAINS = {
    "Ø¨Ø±Ù…Ø¬Ø©": ["JavaScript","Python","C#","Rust","Go","OOP","FP","Patterns","Testing","PWA"],
    "ØªØ´ÙÙŠØ±": ["AES-GCM","ChaCha20-Poly1305","RSA","ECC","Ed25519","SHA-256","Argon2","HKDF","Nonce","TLS"],
    "Ø´Ø¨ÙƒØ§Øª": ["TCP","UDP","HTTP/2","HTTP/3","QUIC","DNS","CDN","Proxy","Load Balancer","Socket"],
    "Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª": ["PostgreSQL","MySQL","MongoDB","Index","ACID","Transactions","Sharding","Replication","Query Plan","Cache"],
    "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": ["CNN","RNN","Transformer","Attention","Embeddings","RL","Prompt","Fine-tune","Inference","Latency"],
    "Ù‡Ù†Ø¯Ø³Ø© Ø¨Ø±Ù…Ø¬ÙŠØ§Øª": ["SOLID","Clean Architecture","DDD","CQRS","Microservices","Monolith","Refactor","Review","DevOps","CI/CD"],
    "Ø£Ù…Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª": ["Threat Model","Zero Trust","WAF","IAM","SSO","Least Privilege","Audit","Key Rotation","Secrets","Encryption"],
    "Ø³Ø­Ø§Ø¨Ø©": ["AWS","Azure","GCP","Kubernetes","Docker","Serverless","Lambda","API Gateway","S3","Blob"],
    "Ø£Ù†Ø¸Ù…Ø©": ["Linux","Windows","Syscall","Process","Thread","Memory","Filesystem","I/O","Kernel","Scheduling"],
    "ÙˆØ§Ø¬Ù‡Ø§Øª ÙˆØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…": ["Accessibility","Design System","Typography","Animations","Dark Mode","Color Contrast","Fitts","Hick","Usability","A/B"],
    "Ù‡Ø²Ø§Ø±": ["Ù†ÙƒØªØ© Ù„Ø·ÙŠÙØ©","Ù„Ø¹Ø¨ ÙƒÙ„Ù…Ø§Øª","Ù…ÙˆÙ‚Ù Ø·Ø±ÙŠÙ","Ø®ÙÙ‘Ø© Ø¸Ù„","Ù…Ø²Ø­Ø© ØªÙ‚Ù†ÙŠØ©"],
    "Ø§Ø®ØªØ±Ø§Ù‚": ["Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©","ØªÙˆØ¹ÙŠØ©","Ø­Ù…Ø§ÙŠØ©","Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ø®Ù„Ø§Ù‚ÙŠØ©","Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ù‚Ø§Ù†ÙˆÙ†ÙŠ"]
  };

  const TEMPLATES = {
    intro: ["Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹: ","ØªÙ…Ù‡ÙŠØ¯: ","ÙÙƒØ±Ø© Ø£Ø³Ø§Ø³ÙŠØ©: ","Ø¥Ø·Ø§Ø± Ø§Ù„ÙÙ‡Ù…: ","Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©: "],
    details: ["Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ©","Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©","Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª","ØªØ­Ø°ÙŠØ±Ø§Øª Ø´Ø§Ø¦Ø¹Ø©","Ø£Ø¯Ø§Ø¡ ÙˆÙ‚ÙŠÙˆØ¯"],
    bullets: ["â€¢ ","â€“ ","* "],
    closers: [
      "Ø®Ù„Ø§ØµØ©: Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø³Ø§Ø·Ø© ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ØªÙƒØ±Ø±.",
      "Ø®Ù„Ø§ØµØ©: Ù‚ÙØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù…Ø¨ÙƒØ±Ù‹Ø§ ÙˆØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ.",
      "Ø®Ù„Ø§ØµØ©: Ø£ÙÙ…ÙÙ‘Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§ÙØµÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¨ØµØ±Ø§Ù…Ø©.",
      "Ø®Ù„Ø§ØµØ©: ÙˆØ«Ù‘Ù‚ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ±Ø§Ù‚Ø¨ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø¬ÙŠØ¯Ù‹Ø§."
    ]
  };

  function makeCodeSnippet(topic, lang){
    const s = {
      "JavaScript": `// ${topic} â€” Ù…Ø«Ø§Ù„ JavaScript
async function example(){
  const encoder = new TextEncoder();
  const data = encoder.encode("hello");
  console.log("len:", data.length);
}`,
      "Python": `# ${topic} â€” Ù…Ø«Ø§Ù„ Python
def example():
    data = "hello".encode("utf-8")
    print("len:", len(data))
example()`,
      "C#": `// ${topic} â€” Ù…Ø«Ø§Ù„ C#
using System;
class Demo {
  static void Main(){
    var data = System.Text.Encoding.UTF8.GetBytes("hello");
    Console.WriteLine("len: " + data.Length);
  }
}`,
      "SQL": `-- ${topic} â€” Ù…Ø«Ø§Ù„ SQL
SELECT name, score
FROM users
WHERE score > 90
ORDER BY score DESC;`,
      "Shell": `# ${topic} â€” Ù…Ø«Ø§Ù„ Shell
text="hello"
echo "${#text}"`
    };
    return s[lang] || "";
  }

  function detectDomainAndTopic(qText){
    const lower = qText.toLowerCase();
    const manual = domainSelect.value || "";
    if(manual){
      const topics = DOMAINS[manual];
      for(const t of topics){ if(lower.includes(t.toLowerCase())) return { domain: manual, topic: t }; }
      return { domain: manual, topic: topics[0] };
    }
    for(const d in DOMAINS){
      for(const t of DOMAINS[d]){
        if(lower.includes(t.toLowerCase())) return { domain: d, topic: t };
      }
    }
    return { domain: "Ø¨Ø±Ù…Ø¬Ø©", topic: "Patterns" };
  }

  function isSensitive(domain, qText){
    const lower = qText.toLowerCase();
    if(domain === "Ø§Ø®ØªØ±Ø§Ù‚"){
      // Ø£ÙŠ Ø·Ù„Ø¨ ÙŠØªØ¶Ù…Ù† ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø£Ùˆ ØªØ¬Ø§ÙˆØ²Ø§Øª ÙŠØ¹ØªØ¨Ø± Ø­Ø³Ø§Ø³
      const badHints = ["Ø§Ø®ØªØ±Ø§Ù‚","ØªÙ‡ÙƒÙŠØ±","Ø¨Ø§ÙŠ Ø¨Ø§Ø³","ØªØ¬Ø§ÙˆØ²","Ø«ØºØ±Ø©","exploit","ddos","sql injection","xss","ÙƒØ±Ø§Ùƒ","ÙƒØ³Ø± Ø­Ù…Ø§ÙŠØ©"];
      return badHints.some(k=>lower.includes(k));
    }
    return false;
  }

  function composeRichReply(question){
    const { domain, topic } = detectDomainAndTopic(question);
    const style = styleSelect.value;
    const codeLang = codeSelect.value;
    const intro = TEMPLATES.intro[Math.floor(Math.random()*TEMPLATES.intro.length)];
    const detailKind = TEMPLATES.details[Math.floor(Math.random()*TEMPLATES.details.length)];
    const bullet = TEMPLATES.bullets[Math.floor(Math.random()*TEMPLATES.bullets.length)];
    const closer = TEMPLATES.closers[Math.floor(Math.random()*TEMPLATES.closers.length)];

    if(isSensitive(domain, question)){
      // Ø±Ø¯ ØªÙˆØ¹ÙˆÙŠ Ø¢Ù…Ù† ØºÙŠØ± Ø¥Ø¬Ø±Ø§Ø¦ÙŠ
      const safe = `${intro} Ø§Ù„Ù…Ø¬Ø§Ù„: ${domain}. Ø§Ù„Ø£Ù…Ø§Ù† Ø£ÙˆÙ„Ø§Ù‹: Ø£ÙŠ Ù…Ø¹Ø±ÙØ© Ø­ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¶Ù…Ù† Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ù‚Ø§Ù†ÙˆÙ†ÙŠ ÙˆØ¨Ù…ÙˆØ§ÙÙ‚Ø© Ù…ÙƒØªÙˆØ¨Ø©. 
${bullet} Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯ ÙˆØ­Ù„ÙˆÙ„ Ø§Ù„Ø­Ù…Ø§ÙŠØ© (WAF, IAM, Least Privilege).
${bullet} Ø­Ø³Ù‘Ù† Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©ØŒ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ØŒ ÙˆØ§Ù„Ø¯ÙØ§Ø¹Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø·Ø¨Ù‚Ø§Øª.
${bullet} Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù†ØµØ§Øª ØªØ¯Ø±ÙŠØ¨ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© ÙˆØªÙˆØ¹ÙˆÙŠØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø£ÙŠ Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ©.
${closer}`;
      const id = fingerprint(question, domain, topic, style, codeLang, intro, detailKind, bullet, closer);
      return { header:`Ø±Ø¯ #${id} â€” Ù…Ø¬Ø§Ù„: ${domain} | Ù…ÙˆØ¶ÙˆØ¹: ${topic} | Ø£Ø³Ù„ÙˆØ¨: ${style}`, text: safe, code: "" };
    }

    // ÙÙ‚Ø±Ø§Øª
    const paragraphA = `${intro}${domain} â€” Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${topic}. Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¯ ÙŠÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ù…ÙÙ‡ÙˆÙ… ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ÙŠ Ø¨ØµÙˆØ±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°.`;
    const paragraphB = `${detailKind}: Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ù‡Ø¯Ù ÙˆØ§Ù„Ù‚ÙŠÙˆØ¯ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©ØŒ Ø¬Ø±Ù‘Ø¨ Ø¨Ø³Ø±Ø¹Ø©ØŒ Ù‚ÙØ³ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ ÙˆØ­Ø³Ù‘Ù† ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§.`;

    const points = [
      `${bullet} Ù„Ù…Ø§Ø°Ø§ ${topic}ØŸ Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø´ÙƒÙ„Ø© Ù…Ø­Ø¯Ø¯Ø© Ø¨ÙƒÙØ§Ø¡Ø© Ø¶Ù…Ù† Ø³ÙŠØ§Ù‚ ÙˆØ§Ø¶Ø­.`,
      `${bullet} Ø®Ø·ÙˆØ§Øª: Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§ØªØŒ Ø§Ø¹Ø²Ù„ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ØŒ Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø­Ø¯ÙˆØ¯ØŒ Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø¡.`,
      `${bullet} Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø©: ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ØŒ Ø¶Ø¹Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±ØŒ ØªØ¹Ù‚ÙŠØ¯ Ù…Ø¨Ø§Ù„Øº ÙÙŠÙ‡.`,
      `${bullet} ØªÙƒØ§Ù…Ù„: Ø§Ø±Ø¨Ø· ${topic} Ù…Ø¹ Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚ØªØŒ ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©.`
    ];

    let body = "";
    if(style === "Ù…Ø®ØªØµØ±"){
      body = `${paragraphA}\n${closer}`;
    } else if(style === "Ù…ÙØµÙ„" || style === "ØªØ¹Ù„ÙŠÙ…ÙŠ"){
      body = `${paragraphA}\n${paragraphB}\n${points.join("\n")}\n${closer}`;
    } else if(style === "ØªÙ‚Ù†ÙŠ"){
      body = `${paragraphA}\n${paragraphB}\n${points.slice(0,3).join("\n")}\n${closer}`;
    } else { // Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø§Ø·
      body = `${paragraphA}\n${points.join("\n")}\n${closer}`;
    }

    // Ù‡Ø²Ø§Ø±: Ø±Ø¯ Ù„Ø·ÙŠÙ Ø¨Ø¯ÙˆÙ† Ø¥Ø³Ø§Ø¡Ø©
    if(domain === "Ù‡Ø²Ø§Ø±"){
      body = `${intro} Ø®ÙÙ‘Ø© Ø¸Ù„ ØªÙ‚Ù†ÙŠØ©: 
${bullet} Ù„Ù…Ø§ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠÙ‚ÙˆÙ„Ùƒ "Internal Error"ØŒ Ù‡Ùˆ Ø¨Ø³ Ù…Ø­ØªØ§Ø¬ Ø´ÙˆÙŠØ© Ù‚Ù‡ÙˆØ© â˜•
${bullet} ÙˆDeveloper Ù„Ù…Ø§ Ø§Ù„Ù€ build ÙŠÙ†Ø¬Ø­ Ù…Ù† Ø£ÙˆÙ„ Ù…Ø±Ø©: ÙŠØªØ£ÙƒØ¯ Ø¥Ù† Ø¯Ù‡ Ù…Ø´ Simulation ğŸ˜…
${closer}`;
    }

    const codeBlock = codeLang !== "Ù„Ø§" ? makeCodeSnippet(topic, codeLang) : "";
    const id = fingerprint(question, domain, topic, style, codeLang, intro, detailKind, bullet, closer);
    return { header:`Ø±Ø¯ #${id} â€” Ù…Ø¬Ø§Ù„: ${domain} | Ù…ÙˆØ¶ÙˆØ¹: ${topic} | Ø£Ø³Ù„ÙˆØ¨: ${style}${codeBlock?" | ÙƒÙˆØ¯: "+codeLang:""}`, text: body, code: codeBlock };
  }

  function fingerprint(...parts){
    let s = parts.join("|");
    let h = 2166136261 >>> 0;
    for(let i=0;i<s.length;i++){ h ^= s.charCodeAt(i); h = Math.imul(h, 16777619); }
    return (h % 1000000);
  }

  function addBubble(text, cls, code){
    const div = document.createElement('div');
    div.className = `bubble ${cls}`;
    div.textContent = text;
    if(code){
      const pre = document.createElement('pre');
      pre.className = 'code';
      pre.textContent = code;
      div.appendChild(pre);
    }
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function sendMessage(){
    const q = (inputEl.value || "").trim();
    if(!q) return;
    addBubble(q, 'user');
    inputEl.value = "";
    setTimeout(()=>{
      const r = composeRichReply(q);
      addBubble(`${r.header}\n\n${r.text}`, 'bot', r.code);
      sessionCount++;
      countBadge.textContent = `Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${sessionCount} Ø±Ø¯`;
    }, 250);
  }

  sendBtn.addEventListener('click', sendMessage);
  inputEl.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
  });

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
  modeDarkBtn.addEventListener('click', ()=>{
    document.documentElement.classList.remove('theme-yellow');
  });
  modeYellowBtn.addEventListener('click', ()=>{
    document.documentElement.classList.add('theme-yellow');
  });

  // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  downloadBtn.addEventListener('click', ()=>{
    const html = document.documentElement.outerHTML;
    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'YASSER-BOT.html';
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  // PWA: ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  window.addEventListener('beforeinstallprompt', (e)=>{
    e.preventDefault(); deferredPrompt = e; installBtn.style.display='inline-block';
  });
  installBtn.addEventListener('click', async ()=>{
    if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; }
    else alert('Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ø¥Ù† Ù„Ù… ÙŠØ¸Ù‡Ø± Ø§Ù„Ø­ÙˆØ§Ø±.');
  });

  // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© + Manifest + SW (ØªÙ‚Ø¯Ø± ØªØ³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ø£ÙŠÙ‚ÙˆÙ†ØªÙƒ)
  async function createIcon(size){
    const c=document.createElement('canvas'); c.width=size; c.height=size;
    const ctx=c.getContext('2d');
    const g=ctx.createLinearGradient(0,0,size,size); g.addColorStop(0, getComputedStyle(document.documentElement).getPropertyValue('--primary').trim() || '#0ea5e9'); g.addColorStop(1,'#6366f1');
    ctx.fillStyle=g; ctx.fillRect(0,0,size,size);
    ctx.fillStyle='#fff'; ctx.font=`${Math.floor(size*0.26)}px sans-serif`; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('YASSER', size/2, size/2);
    const b=await new Promise(res=>c.toBlob(res,'image/png')); return URL.createObjectURL(b);
  }
  async function setupManifest(){
    const icon192=await createIcon(192); const icon512=await createIcon(512);
    const manifest={name:"YASSER BOT â€” 1M Replies",short_name:"YASSER BOT",start_url:"./",display:"standalone",background_color:"#0f172a",theme_color:"#0ea5e9",icons:[{src:icon192,sizes:"192x192",type:"image/png"},{src:icon512,sizes:"512x512",type:"image/png"}]};
    const blob=new Blob([JSON.stringify(manifest)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const link=document.createElement('link'); link.rel='manifest'; link.href=url; document.head.appendChild(link);
  }
  async function setupSW(){
    if(!('serviceWorker' in navigator)) return;
    const sw = `
      const CACHE='yasser-bot-onefile-v1';
      self.addEventListener('install',e=>{ e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./']))); self.skipWaiting(); });
      self.addEventListener('activate',e=>{ e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!==CACHE).map(k=>caches.delete(k))))); self.clients.claim(); });
      self.addEventListener('fetch',e=>{
        e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{
          const copy=res.clone(); caches.open(CACHE).then(c=>c.put(e.request,copy)); return res;
        })));
      });
    `;
    const blob=new Blob([sw],{type:'application/javascript'});
    const url=URL.createObjectURL(blob);
    navigator.serviceWorker.register(url,{scope:'./'});
  }

  (async function boot(){
    await setupManifest();
    await setupSW();
    addBubble("Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ YASSER BOT. Ø§Ø³Ø£Ù„Ù†ÙŠ ÙÙŠ Ø£ÙŠ Ù…Ø¬Ø§Ù„ØŒ ÙˆØ§Ø®ØªØ± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠ ÙŠØ¹Ø¬Ø¨Ùƒ Ù…Ù† Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ âœ¨", "bot");
  })();
})();
</script>
</body>
</html>
