<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>بوت محادثة ذكي</title>
  <meta name="theme-color" content="#0ea5e9">
  <style>
    body{margin:0;font-family:system-ui,"Noto Sans Arabic",sans-serif;background:#0f172a;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh}
    .chat{width:min(600px,90vw);background:rgba(255,255,255,0.05);border-radius:16px;padding:16px;display:flex;flex-direction:column;height:80vh}
    .messages{flex:1;overflow:auto;margin-bottom:12px}
    .msg{padding:10px;margin:6px 0;border-radius:10px;max-width:80%}
    .user{background:#2563eb;align-self:flex-end}
    .bot{background:#374151;align-self:flex-start}
    .inputRow{display:flex;gap:8px}
    input{flex:1;padding:10px;border-radius:10px;border:none}
    button{padding:10px 14px;border:none;border-radius:10px;background:#0ea5e9;color:#fff;font-weight:700;cursor:pointer}
  </style>
</head>
<body>
  <div class="chat">
    <div class="messages" id="messages"></div>
    <div class="inputRow">
      <input id="input" placeholder="اكتب رسالتك...">
      <button id="sendBtn">إرسال</button>
    </div>
  </div>

<script>
(function(){
  const msgs=document.getElementById('messages');
  const input=document.getElementById('input');
  const sendBtn=document.getElementById('sendBtn');

  // قاعدة بيانات ردود (كلمات مفتاحية → ردود)
  const knowledgeBase = {
    "برمجة":["البرمجة هي فن تحويل الأفكار إلى تعليمات يفهمها الكمبيوتر.","يمكنك البدء بلغات مثل Python أو JavaScript."],
    "تشفير":["التشفير يحمي البيانات من الوصول غير المصرح به.","من أشهر الخوارزميات: AES و RSA."],
    "HTML":["HTML هي لغة بناء صفحات الويب.","تستخدم الوسوم مثل <div> و <p>."],
    "CSS":["CSS مسؤولة عن تنسيق صفحات الويب.","يمكنك التحكم في الألوان والخطوط والتخطيط."],
    "JavaScript":["JavaScript تضيف التفاعلية للمواقع.","مثال: التعامل مع الأحداث أو تعديل DOM."],
    "بوت":["البوت هو برنامج يرد تلقائيًا على المستخدم.","يمكنك استخدام الذكاء الاصطناعي لجعل البوت أكثر ذكاءً."]
  };

  // توليد 10000 رد افتراضي (للتوسعة)
  const fallbackReplies=[];
  for(let i=1;i<=10000;i++){
    fallbackReplies.push(`رد افتراضي رقم ${i}: لا يوجد رد محدد لهذا السؤال.`);
  }
  let fallbackCounter=0;

  function addMessage(text,cls){
    const div=document.createElement('div');
    div.className='msg '+cls;
    div.textContent=text;
    msgs.appendChild(div);
    msgs.scrollTop=msgs.scrollHeight;
  }

  function botReply(userText){
    const lower=userText.toLowerCase();
    let found=false;
    for(const key in knowledgeBase){
      if(lower.includes(key.toLowerCase())){
        const responses=knowledgeBase[key];
        const reply=responses[Math.floor(Math.random()*responses.length)];
        addMessage(reply,'bot');
        found=true;
        break;
      }
    }
    if(!found){
      const reply=fallbackReplies[fallbackCounter % fallbackReplies.length];
      fallbackCounter++;
      addMessage(reply,'bot');
    }
  }

  sendBtn.onclick=()=>{
    const text=input.value.trim();
    if(!text) return;
    addMessage(text,'user');
    input.value='';
    setTimeout(()=>botReply(text),500);
  };

  // Manifest + Service Worker
  async function createIcon(size){
    const c=document.createElement('canvas');c.width=size;c.height=size;
    const ctx=c.getContext('2d');
    ctx.fillStyle="#0ea5e9";ctx.fillRect(0,0,size,size);
    ctx.fillStyle="#fff";ctx.font=`${size*0.3}px sans-serif`;ctx.textAlign="center";ctx.textBaseline="middle";
    ctx.fillText("BOT",size/2,size/2);
    const b=await new Promise(res=>c.toBlob(res,'image/png'));return URL.createObjectURL(b);
  }
  async function setupManifest(){
    const i192=await createIcon(192);const i512=await createIcon(512);
    const m={name:"Smart ChatBot 10k Replies",short_name:"SmartBot",start_url:"./",display:"standalone",background_color:"#0f172a",theme_color:"#0ea5e9",icons:[{src:i192,sizes:"192x192",type:"image/png"},{src:i512,sizes:"512x512",type:"image/png"}]};
    const blob=new Blob([JSON.stringify(m)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const link=document.createElement('link');link.rel='manifest';link.href=url;document.head.appendChild(link);
  }
  async function setupSW(){
    if(!('serviceWorker' in navigator)) return;
    const sw=`const C='smartbot-v1';self.addEventListener('install',e=>{e.waitUntil(caches.open(C).then(c=>c.addAll(['./'])));self.skipWaiting();});self.addEventListener('activate',e=>{e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!==C).map(k=>caches.delete(k)))));self.clients.claim();});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{const copy=res.clone();caches.open(C).then(c=>c.put(e.request,copy));return res;})));});`;
    const blob=new Blob([sw],{type:'application/javascript'});
    const url=URL.createObjectURL(blob);
    navigator.serviceWorker.register(url,{scope:'./'});
  }
  (async function boot(){await setupManifest();await setupSW();})();
})();
</script>
</body>
</html>
