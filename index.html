<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>YASSER BOT â€” Ø¨Ø±Ùˆ Ø²Ø¬Ø§Ø¬ÙŠØŒ Ù…Ù„ÙŠÙˆÙ† Ø±Ø¯ Ø°ÙƒÙŠ</title>
  <meta name="theme-color" content="#0ea5e9">
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8;
      --primary:#0ea5e9; --accent:#22d3ee; --user:#2563eb; --bot:#1f2937;
      --glass1:rgba(255,255,255,0.08); --glass2:rgba(255,255,255,0.04); --border:rgba(255,255,255,0.14);
    }
    :root.theme-yellow{
      --bg:#0a0a06; --panel:#14140a; --text:#fffbe6; --muted:#f7e8a1;
      --primary:#f5c518; --accent:#ffd65b; --user:#f5c518; --bot:#2a240f;
      --glass1:rgba(245,197,24,0.15); --glass2:rgba(245,197,24,0.07); --border:rgba(245,197,24,0.28);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,"Noto Sans Arabic",Segoe UI,Roboto,sans-serif;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(14,165,233,0.20), transparent),
        radial-gradient(900px 500px at 10% 120%, rgba(99,102,241,0.16), transparent),
        linear-gradient(160deg,var(--bg),var(--panel));
      color:var(--text);
    }
    /* Top bar glass */
    .topbar{
      position:sticky; top:0; z-index:50;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 16px; backdrop-filter:blur(12px) saturate(1.06);
      background:linear-gradient(180deg, var(--glass1), var(--glass2));
      border-bottom:1px solid var(--border);
      box-shadow:0 10px 40px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.10);
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:
      conic-gradient(from 210deg,var(--primary),var(--accent),#6366f1,var(--primary));
      box-shadow:0 6px 18px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.35);
    }
    .title{font-weight:800;letter-spacing:.25px}
    .muted{color:var(--muted);font-size:.9rem}
    .actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--border);outline:none;cursor:pointer;
      padding:10px 12px;border-radius:10px;font-weight:800;color:white;
      background:linear-gradient(180deg,var(--primary),#2563eb);
      transition:transform .12s ease, filter .2s ease;
    }
    .btn:hover{transform:translateY(-1px);filter:saturate(1.08)}
    .btn.ghost{background:linear-gradient(180deg, var(--glass1), var(--glass2))}
    /* Layout */
    .wrap{max-width:1100px;margin:18px auto;padding:0 16px}
    .panel{
      border:1px solid var(--border); border-radius:18px;
      background:linear-gradient(180deg, var(--glass1), var(--glass2));
      backdrop-filter:blur(12px) saturate(1.06);
      box-shadow:0 25px 60px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .grid{display:grid;grid-template-columns:320px 1fr;gap:16px}
    @media(max-width:960px){ .grid{grid-template-columns:1fr} }
    .card{padding:14px;display:flex;flex-direction:column;gap:12px}
    .select, textarea{
      width:100%; background:rgba(2,6,23,0.5); color:var(--text);
      border:1px solid var(--border); border-radius:10px; padding:10px;
      backdrop-filter:blur(8px);
    }
    .badge{
      display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;
      background:rgba(34,197,94,0.12);color:#a7f3d0;border:1px dashed rgba(34,197,94,0.35);font-weight:800
    }
    .badge.warn{background:rgba(245,158,11,0.12);color:#fde68a;border-color:rgba(245,158,11,0.35)}
    /* Messages */
    .messages{padding:16px;min-height:58vh;overflow:auto}
    .bubble{
      max-width:72%; margin:8px 0; padding:12px; border-radius:14px; white-space:pre-wrap;
      background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.08));
      border:1px solid var(--border);
      box-shadow:0 10px 30px rgba(0,0,0,0.28);
    }
    .bubble.user{background:linear-gradient(180deg,var(--user),#1e40af); margin-left:auto}
    .bubble.bot{background:linear-gradient(180deg,var(--bot),#0b0f19); margin-right:auto}
    .header{font-weight:900;margin-bottom:6px}
    .composer{
      display:flex;gap:10px;padding:12px;border-top:1px solid var(--border);
      background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0.26)); backdrop-filter:blur(8px);
      border-bottom-left-radius:18px;border-bottom-right-radius:18px;
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <div class="title">YASSER BOT â€” Ø¨Ø±Ùˆ Ø²Ø¬Ø§Ø¬ÙŠ</div>
        <div class="muted">Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ«Ø¨ÙŠØª Â· Ù…Ù„ÙŠÙˆÙ† Ø±Ø¯ Ø°ÙƒÙŠ ØºÙŠØ± Ù…ØªÙƒØ±Ø±</div>
      </div>
    </div>
    <div class="actions">
      <button id="modeDarkBtn" class="btn">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
      <button id="modeYellowBtn" class="btn ghost">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ØµÙØ±</button>
      <button id="installBtn" class="btn ghost" style="display:none">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
      <button id="downloadBtn" class="btn ghost">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</button>
      <button id="clearBtn" class="btn ghost">Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <aside class="panel card" id="configPanel">
        <div class="badge">ÙØ¶Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯: ~1,000,000 Ø±Ø¯</div>
        <div class="badge warn" id="countBadge">Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: 0 Ø±Ø¯</div>

        <label class="muted">Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label>
        <select id="domainSelect" class="select">
          <option value="">ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
          <option>Ø¨Ø±Ù…Ø¬Ø©</option>
          <option>ØªØ´ÙÙŠØ±</option>
          <option>Ø´Ø¨ÙƒØ§Øª</option>
          <option>Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</option>
          <option>Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option>
          <option>Ù‡Ù†Ø¯Ø³Ø© Ø¨Ø±Ù…Ø¬ÙŠØ§Øª</option>
          <option>Ø£Ù…Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
          <option>Ø³Ø­Ø§Ø¨Ø©</option>
          <option>Ø£Ù†Ø¸Ù…Ø©</option>
          <option>ÙˆØ§Ø¬Ù‡Ø§Øª ÙˆØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</option>
          <option>Ù‡Ø²Ø§Ø±</option>
          <option>Ø§Ø®ØªØ±Ø§Ù‚</option>
        </select>

        <label class="muted">Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¯</label>
        <select id="styleSelect" class="select">
          <option value="Ù…Ø®ØªØµØ±">Ù…Ø®ØªØµØ±</option>
          <option value="Ù…ÙØµÙ„">Ù…ÙØµÙ„</option>
          <option value="ØªÙ‚Ù†ÙŠ">ØªÙ‚Ù†ÙŠ</option>
          <option value="ØªØ¹Ù„ÙŠÙ…ÙŠ">ØªØ¹Ù„ÙŠÙ…ÙŠ</option>
          <option value="Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø§Ø·">Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø§Ø·</option>
        </select>
      </aside>

      <section class="panel" style="display:flex;flex-direction:column">
        <div id="messages" class="messages" role="log" aria-live="polite"></div>
        <div class="composer">
          <textarea id="input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." aria-label="Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©"></textarea>
          <button id="sendBtn" class="btn">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
      </section>
    </section>
  </main>

<script>
document.addEventListener('DOMContentLoaded', ()=>{
  // Elements
  const sendBtn = document.getElementById('sendBtn');
  const inputEl = document.getElementById('input');
  const messagesEl = document.getElementById('messages');
  const countBadge = document.getElementById('countBadge');
  const domainSelect = document.getElementById('domainSelect');
  const styleSelect = document.getElementById('styleSelect');
  const modeDarkBtn = document.getElementById('modeDarkBtn');
  const modeYellowBtn = document.getElementById('modeYellowBtn');
  const installBtn = document.getElementById('installBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const clearBtn = document.getElementById('clearBtn');

  let sessionCount = 0;
  let deferredPrompt = null;
  const usedIds = new Set(); // Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø­ØªÙ‰ Ù…Ù„ÙŠÙˆÙ†

  // Domains + keywords
  const DOMAINS = {
    "Ø¨Ø±Ù…Ø¬Ø©": ["javascript","python","c#","rust","go","oop","fp","patterns","testing","pwa"],
    "ØªØ´ÙÙŠØ±": ["aes-gcm","chacha20","rsa","ecc","ed25519","sha-256","argon2","hkdf","nonce","tls"],
    "Ø´Ø¨ÙƒØ§Øª": ["tcp","udp","http/2","http/3","quic","dns","cdn","proxy","load balancer","socket"],
    "Ù‚ÙˆØ§Ø¹Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª": ["postgresql","mysql","mongodb","index","acid","transactions","sharding","replication","query plan","cache"],
    "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": ["cnn","rnn","transformer","attention","embeddings","rl","prompt","fine-tune","inference","latency"],
    "Ù‡Ù†Ø¯Ø³Ø© Ø¨Ø±Ù…Ø¬ÙŠØ§Øª": ["solid","clean architecture","ddd","cqrs","microservices","monolith","refactor","devops","ci/cd"],
    "Ø£Ù…Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª": ["threat model","zero trust","waf","iam","sso","least privilege","audit","key rotation","secrets","encryption"],
    "Ø³Ø­Ø§Ø¨Ø©": ["aws","azure","gcp","kubernetes","docker","serverless","lambda","api gateway","s3","blob"],
    "Ø£Ù†Ø¸Ù…Ø©": ["linux","windows","syscall","process","thread","memory","filesystem","io","kernel","scheduling"],
    "ÙˆØ§Ø¬Ù‡Ø§Øª ÙˆØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…": ["accessibility","design system","typography","animations","dark mode","color contrast","usability","a/b"],
    "Ù‡Ø²Ø§Ø±": ["Ù†ÙƒØªØ©","Ù…Ø²Ø­Ø©","Ù…ÙˆÙ‚Ù Ø·Ø±ÙŠÙ","Ù†ÙƒØªØ© ØªÙ‚Ù†ÙŠØ©","Ø¶Ø­Ùƒ"],
    "Ø§Ø®ØªØ±Ø§Ù‚": ["Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©","ØªÙˆØ¹ÙŠØ©","Ø­Ù…Ø§ÙŠØ©","Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚","ethical"]
  };

  const TEMPLATES = {
    intro: ["Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹: ","ØªÙ…Ù‡ÙŠØ¯: ","ÙÙƒØ±Ø© Ø£Ø³Ø§Ø³ÙŠØ©: ","Ø¥Ø·Ø§Ø± Ø§Ù„ÙÙ‡Ù…: ","Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©: "],
    detail: ["ØªÙØ§ØµÙŠÙ„ ØªÙ‚Ù†ÙŠØ©","Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª","Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©","ØªØ­Ø°ÙŠØ±Ø§Øª Ø´Ø§Ø¦Ø¹Ø©","Ø£Ø¯Ø§Ø¡ ÙˆÙ‚ÙŠÙˆØ¯"],
    bullet: ["â€¢ ","â€“ ","* "],
    closer: [
      "Ø§Ù„Ø®Ù„Ø§ØµØ©: Ø¨Ø³Ø§Ø·Ø© + Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø³ØªÙ…Ø± = Ø¬ÙˆØ¯Ø©.",
      "Ø§Ù„Ø®Ù„Ø§ØµØ©: Ù‚ÙØ³ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù…Ø¨ÙƒØ±Ù‹Ø§ ÙˆØªØ¬Ù†Ù‘Ø¨ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯.",
      "Ø§Ù„Ø®Ù„Ø§ØµØ©: Ø£ÙÙ…ÙÙ‘Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§ÙØµÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.",
      "Ø§Ù„Ø®Ù„Ø§ØµØ©: ÙˆØ«Ù‘Ù‚ Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª ÙˆØ±Ø§Ù‚Ø¨ Ø§Ù„Ø¥Ù†ØªØ§Ø¬."
    ],
    variants: ["A","B","C","D","E","F","G","H","I","J"] // Ù„Ø²ÙŠØ§Ø¯Ø© ØªÙ†ÙˆØ¹ Ø§Ù„Ù†Øµ
  };

  function detectDomainAndTopic(text){
    const lower = text.toLowerCase();
    const manual = domainSelect.value || "";
    if(manual){
      const topics = DOMAINS[manual] || [];
      for(const t of topics){ if(lower.includes(t)) return {domain:manual, topic:t}; }
      return {domain:manual, topic:topics[0] || manual};
    }
    for(const d in DOMAINS){
      for(const t of DOMAINS[d]){
        if(lower.includes(t)) return {domain:d, topic:t};
      }
    }
    return {domain:"Ø¨Ø±Ù…Ø¬Ø©", topic:"patterns"};
  }

  function isSensitive(domain, text){
    if(domain!=="Ø§Ø®ØªØ±Ø§Ù‚") return false;
    const lower = text.toLowerCase();
    const badHints = ["Ø§Ø®ØªØ±Ø§Ù‚","ØªÙ‡ÙƒÙŠØ±","exploit","ddos","sql injection","xss","ÙƒØ±Ø§Ùƒ","ÙƒØ³Ø± Ø­Ù…Ø§ÙŠØ©","Ø¨Ø§ÙŠ Ø¨Ø§Ø³","bypass"];
    return badHints.some(k=>lower.includes(k));
  }

  function hashCode(s){
    let h = 2166136261 >>> 0;
    for(let i=0;i<s.length;i++){ h ^= s.charCodeAt(i); h = Math.imul(h, 16777619); }
    return h >>> 0;
  }

  function uniqueId(seed){
    // Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ØªÙ‰ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù„Ø³Ø©
    let salt = 0, tries = 0;
    while(tries < 50){
      const id = (hashCode(seed + "|" + salt) % 1000000);
      if(!usedIds.has(id)){ usedIds.add(id); return id; }
      salt++; tries++;
    }
    // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙ†Ø²Ø§ÙØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ…ÙŠÙ‘Ø²
    const fallback = (sessionCount % 1000000);
    usedIds.add(fallback);
    return fallback;
  }

  function composeReply(question){
    const {domain, topic} = detectDomainAndTopic(question);
    const style = styleSelect.value || "Ù…ÙØµÙ„";
    const intro = TEMPLATES.intro[Math.floor(Math.random()*TEMPLATES.intro.length)];
    const detail = TEMPLATES.detail[Math.floor(Math.random()*TEMPLATES.detail.length)];
    const bullet = TEMPLATES.bullet[Math.floor(Math.random()*TEMPLATES.bullet.length)];
    const closer = TEMPLATES.closer[Math.floor(Math.random()*TEMPLATES.closer.length)];
    const variant = TEMPLATES.variants[Math.floor(Math.random()*TEMPLATES.variants.length)];

    // Ù‡ÙˆÙŠØ© ÙØ±ÙŠØ¯Ø© Ù„Ù„Ø±Ø¯
    const id = uniqueId(`${question}|${domain}|${topic}|${style}|${intro}|${detail}|${bullet}|${closer}|${variant}|${sessionCount}`);

    // Ù…Ø­ØªÙˆÙ‰ Ø¢Ù…Ù† Ù„Ù„Ù‡Ø²Ø§Ø± ÙˆØ§Ù„Ø§Ø®ØªØ±Ø§Ù‚
    if(domain === "Ù‡Ø²Ø§Ø±"){
      const body = `${intro}Ø®ÙØ© Ø¸Ù„ (${variant}):\n${bullet} Ø§Ù„Ø³ÙŠØ±ÙØ± Ù‚Ø§Ù„ "Internal Error"ØŸ ØºØ§Ù„Ø¨Ù‹Ø§ Ù…Ø­ØªØ§Ø¬ Ù‚Ù‡ÙˆØ© â˜•\n${bullet} Ù„Ùˆ Ø§Ù„Ù€ build Ù†Ø¬Ø­ Ù…Ù† Ø£ÙˆÙ„ Ù…Ø±Ø©: Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø¨Ø­ÙØ¨ ğŸ˜…\n${closer}`;
      return {header:`Ø±Ø¯ #${id} â€” ${domain} | ${topic} | ${style}`, text: body};
    }
    if(isSensitive(domain, question)){
      const body = `${intro}${domain}: ØªÙˆØ¹ÙŠØ© ÙÙ‚Ø·.\n${bullet} Ø§Ù„ØªØ²Ù… Ø¨Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø®ØªØ±Ø§Ù‚ Ù‚Ø§Ù†ÙˆÙ†ÙŠ ÙˆÙ…ÙˆØ§ÙÙ‚Ø© Ù…ÙƒØªÙˆØ¨Ø©.\n${bullet} Ø±ÙƒÙ‘Ø² Ø¹Ù„Ù‰ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯ØŒ Ø§Ù„ØªØµØ­ÙŠØ­ØŒ ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©.\n${bullet} Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù†ØµØ§Øª ØªØ¯Ø±ÙŠØ¨ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©.\n${closer}`;
      return {header:`Ø±Ø¯ #${id} â€” ${domain} | ${topic} | ${style}`, text: body};
    }

    // Ø£Ø³Ø§Ù„ÙŠØ¨ Ù…Ø®ØªÙ„ÙØ©
    const pA = `${intro}${domain} â€” Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹: ${topic}. Ø¥ØµØ¯Ø§Ø± (${variant}).`;
    const pB = `${detail}: Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ù‡Ø¯Ù ÙˆØ§Ù„Ù‚ÙŠÙˆØ¯ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¯ÙˆØ§ØªØŒ Ø¬Ø±Ù‘Ø¨ Ø¨Ø³Ø±Ø¹Ø©ØŒ Ù‚ÙØ³ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ØŒ ÙˆØ­Ø³Ù‘Ù† ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§.`;
    const points = [
      `${bullet} Ù„Ù…Ø§Ø°Ø§ ${topic}ØŸ Ù„Ø£Ù†Ù‡ ÙŠØ­Ù„ Ù…Ø´ÙƒÙ„Ø© Ù…Ø­Ø¯Ø¯Ø© Ø¨ÙƒÙØ§Ø¡Ø© Ø¶Ù…Ù† Ø³ÙŠØ§Ù‚ ÙˆØ§Ø¶Ø­.`,
      `${bullet} Ø®Ø·ÙˆØ§Øª Ø¹Ù…Ù„ÙŠØ©: Ø­Ø¯Ù‘Ø¯ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§ØªØŒ Ø§Ø¹Ø²Ù„ Ø§Ù„ØªØ¹Ù‚ÙŠØ¯ØŒ Ø§Ø®ØªØ¨Ø± Ø§Ù„Ø­Ø¯ÙˆØ¯ØŒ Ø±Ø§Ù‚Ø¨ Ø§Ù„Ø£Ø¯Ø§Ø¡.`,
      `${bullet} Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ø¦Ø¹Ø©: ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ØŒ Ø¶Ø¹Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø±Ø§Ø±ØŒ ØªØ¹Ù‚ÙŠØ¯ Ù…Ø¨Ø§Ù„Øº ÙÙŠÙ‡.`,
      `${bullet} ØªÙƒØ§Ù…Ù„: Ø§Ø±Ø¨Ø· ${topic} Ù…Ø¹ Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚ØªØŒ ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©.`
    ];
    let body = "";
    if(style === "Ù…Ø®ØªØµØ±"){
      body = `${pA}\n${closer}`;
    } else if(style === "Ù…ÙØµÙ„" || style === "ØªØ¹Ù„ÙŠÙ…ÙŠ"){
      body = `${pA}\n${pB}\n${points.join("\n")}\n${closer}`;
    } else if(style === "ØªÙ‚Ù†ÙŠ"){
      body = `${pA}\n${pB}\n${points.slice(0,3).join("\n")}\n${closer}`;
    } else { // Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø§Ø·
      body = `${pA}\n${points.join("\n")}\n${closer}`;
    }
    return {header:`Ø±Ø¯ #${id} â€” ${domain} | ${topic} | ${style}`, text: body};
  }

  function addBubble(text, cls){
    const div = document.createElement('div');
    div.className = `bubble ${cls}`;
    const lines = text.split('\n');
    const header = lines[0] || "";
    const rest = lines.slice(1).join('\n');
    const h = document.createElement('div'); h.className = 'header'; h.textContent = header;
    div.appendChild(h);
    if(rest){
      const b = document.createElement('div'); b.textContent = rest; div.appendChild(b);
    }
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function send(){
    const q = (inputEl.value || "").trim();
    if(!q) return;
    addBubble(`YASSER: ${q}`, 'user');
    inputEl.value = "";
    setTimeout(()=>{
      const r = composeReply(q);
      addBubble(`${r.header}\n\n${r.text}`, 'bot');
      sessionCount++;
      countBadge.textContent = `Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${sessionCount} Ø±Ø¯`;
    }, 240);
  }

  // Events
  sendBtn.addEventListener('click', send);
  inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }});
  modeDarkBtn.addEventListener('click', ()=> document.documentElement.classList.remove('theme-yellow'));
  modeYellowBtn.addEventListener('click', ()=> document.documentElement.classList.add('theme-yellow'));
  clearBtn.addEventListener('click', ()=>{
    messagesEl.innerHTML = "";
    sessionCount = 0; usedIds.clear();
    countBadge.textContent = `Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: 0 Ø±Ø¯`;
    addBubble("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©. Ø§Ø¨Ø¯Ø£ Ø³Ø¤Ø§Ù„Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§.", "bot");
  });

  // Download current HTML
  downloadBtn.addEventListener('click', ()=>{
    const html = document.documentElement.outerHTML;
    const blob = new Blob([html], {type:'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'YASSER-BOT-pro-glass.html';
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  // PWA install
  window.addEventListener('beforeinstallprompt', (e)=>{
    e.preventDefault(); deferredPrompt = e; installBtn.style.display='inline-block';
  });
  installBtn.addEventListener('click', async ()=>{
    if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.style.display='none'; }
    else alert('Ø§Ø³ØªØ®Ø¯Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙØ­ Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ù† Ù„Ù… ÙŠØ¸Ù‡Ø± Ø§Ù„Ø­ÙˆØ§Ø±.');
  });

  // Icon (custom) + manifest
  async function createIcon(size){
    const c=document.createElement('canvas'); c.width=size; c.height=size;
    const ctx=c.getContext('2d');
    // Ø®Ù„ÙÙŠØ© Ø²Ø¬Ø§Ø¬ÙŠØ© Ø¨ØªØ¯Ø±Ø¬
    const g=ctx.createLinearGradient(0,0,size,size); g.addColorStop(0,'#0ea5e9'); g.addColorStop(1,'#6366f1');
    ctx.fillStyle=g; ctx.fillRect(0,0,size,size);
    // Ø¯Ø§Ø¦Ø±Ø© ÙØ¶ÙŠØ©
    ctx.strokeStyle='rgba(255,255,255,0.75)'; ctx.lineWidth=size*0.05; ctx.beginPath();
    ctx.arc(size/2,size/2,size*0.42,0,Math.PI*2); ctx.stroke();
    // Ù†Øµ YASSER BOT
    ctx.fillStyle='#ffffff'; ctx.font=`${Math.floor(size*0.16)}px sans-serif`; ctx.textAlign='center'; ctx.textBaseline='middle';
    ctx.fillText('YASSER', size/2, size*0.42);
    ctx.font=`${Math.floor(size*0.12)}px sans-serif`;
    ctx.fillText('BOT', size/2, size*0.62);
    const b=await new Promise(res=>c.toBlob(res,'image/png')); return URL.createObjectURL(b);
  }
  async function setupManifest(){
    try{
      const i192=await createIcon(192); const i512=await createIcon(512);
      const m={name:"YASSER BOT â€” Pro Glass",short_name:"YASSER BOT",start_url:"./",display:"standalone",background_color:"#0f172a",theme_color:"#0ea5e9",icons:[{src:i192,sizes:"192x192",type:"image/png"},{src:i512,sizes:"512x512",type:"image/png"}]};
      const blob=new Blob([JSON.stringify(m)],{type:'application/json'});
      const url=URL.createObjectURL(blob);
      const link=document.createElement('link'); link.rel='manifest'; link.href=url; document.head.appendChild(link);
    }catch(e){}
  }

  // Service Worker (basic offline)
  async function setupSW(){
    if(!('serviceWorker' in navigator)) return;
    const sw = `
      const CACHE='yasser-pro-glass-v1';
      self.addEventListener('install',e=>{ e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./']))); self.skipWaiting(); });
      self.addEventListener('activate',e=>{ e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!==CACHE).map(k=>caches.delete(k))))); self.clients.claim(); });
      self.addEventListener('fetch',e=>{
        e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request).then(res=>{
          const copy=res.clone(); caches.open(CACHE).then(c=>c.put(e.request,copy)); return res;
        })).catch(()=>caches.match('./')));
      });
    `;
    const blob=new Blob([sw],{type:'application/javascript'});
    const url=URL.createObjectURL(blob);
    navigator.serviceWorker.register(url,{scope:'./'});
  }

  // Boot
  (async function boot(){
    await setupManifest();
    await setupSW();
    addBubble("Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ YASSER BOT â€” Ø¨Ø±Ùˆ Ø²Ø¬Ø§Ø¬ÙŠ. Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠ ÙŠØ¹Ø¬Ø¨Ùƒ ÙˆØ§Ø³Ø£Ù„ ÙÙŠ Ø£ÙŠ Ù…Ø¬Ø§Ù„.", "bot");
  })();
});
</script>
</body>
</html>
