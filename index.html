<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>YASSER BOT — نسخة بسيطة</title>
<meta name="theme-color" content="#0ea5e9">
<style>
  body{margin:0;font-family:"Noto Sans Arabic",sans-serif;background:#0f172a;color:#fff;display:flex;flex-direction:column;height:100vh}
  header{background:#1f2937;padding:10px;display:flex;justify-content:space-between;align-items:center}
  .btn{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;margin:0 4px}
  .btn.primary{background:#0ea5e9;color:#fff}
  .btn.secondary{background:#374151;color:#fff}
  #messages{flex:1;overflow:auto;padding:10px}
  .bubble{margin:6px;padding:10px;border-radius:8px;max-width:70%}
  .user{background:#2563eb;margin-left:auto}
  .bot{background:#374151;margin-right:auto}
  footer{display:flex;padding:10px;background:#111827}
  textarea{flex:1;padding:8px;border-radius:6px;border:none}
  body.yellow{background:#fffbe6;color:#222}
  body.yellow header{background:#f5c518}
  body.yellow .btn.primary{background:#f5c518;color:#000}
</style>
</head>
<body>
<header>
  <div><strong>YASSER BOT</strong></div>
  <div>
    <button id="modeBtn" class="btn secondary">تبديل الوضع</button>
    <button id="installBtn" class="btn secondary" style="display:none">تثبيت</button>
    <button id="downloadBtn" class="btn secondary">تنزيل</button>
  </div>
</header>
<div id="messages"></div>
<footer>
  <textarea id="input" placeholder="اكتب رسالتك..."></textarea>
  <button id="sendBtn" class="btn primary">إرسال</button>
</footer>

<script>
document.addEventListener('DOMContentLoaded',()=>{
  const sendBtn=document.getElementById('sendBtn');
  const input=document.getElementById('input');
  const messages=document.getElementById('messages');
  const modeBtn=document.getElementById('modeBtn');
  const installBtn=document.getElementById('installBtn');
  const downloadBtn=document.getElementById('downloadBtn');
  let deferredPrompt=null, count=0;

  function addBubble(text,cls){
    const div=document.createElement('div');
    div.className="bubble "+cls;
    div.textContent=text;
    messages.appendChild(div);
    messages.scrollTop=messages.scrollHeight;
  }

  function reply(q){
    count++;
    const id=Math.floor(Math.random()*1000000);
    addBubble(`رد #${id}: إجابة ذكية عن "${q}"`, 'bot');
  }

  function send(){
    const q=input.value.trim();
    if(!q) return;
    addBubble("YASSER: "+q,'user');
    input.value="";
    setTimeout(()=>reply(q),300);
  }

  sendBtn.onclick=send;
  input.onkeydown=(e)=>{if(e.key==="Enter"&&!e.shiftKey){e.preventDefault();send();}};

  modeBtn.onclick=()=>document.body.classList.toggle('yellow');

  downloadBtn.onclick=()=>{
    const html=document.documentElement.outerHTML;
    const blob=new Blob([html],{type:'text/html'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download="YASSER-BOT-simple.html";
    a.click();URL.revokeObjectURL(url);
  };

  window.addEventListener('beforeinstallprompt',(e)=>{
    e.preventDefault();deferredPrompt=e;installBtn.style.display='inline-block';
  });
  installBtn.onclick=async()=>{
    if(deferredPrompt){deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;installBtn.style.display='none';}
  };

  // Manifest + SW
  async function setupManifest(){
    const manifest={name:"YASSER BOT Simple",short_name:"YASSER BOT",start_url:"./",display:"standalone",background_color:"#0f172a",theme_color:"#0ea5e9",icons:[]};
    const blob=new Blob([JSON.stringify(manifest)],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const link=document.createElement('link');link.rel='manifest';link.href=url;document.head.appendChild(link);
  }
  async function setupSW(){
    if('serviceWorker' in navigator){
      const sw=`const CACHE='yasser-simple-v1';
      self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])));self.skipWaiting();});
      self.addEventListener('activate',e=>{self.clients.claim();});
      self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)));});`;
      const blob=new Blob([sw],{type:'application/javascript'});
      const url=URL.createObjectURL(blob);
      navigator.serviceWorker.register(url,{scope:'./'});
    }
  }
  setupManifest();setupSW();

  addBubble("مرحبًا! أنا YASSER BOT البسيط. اكتب رسالة وجرب الأزرار.",'bot');
});
</script>
</body>
</html>
